/* ZIRAXA — interactive digital brochure
   Update your personal/company information here (single source of truth):
*/
const PROFILE = {
  companyLatin: "ZIRAXA",
  companyFa: "زیرکسا",
  contactPerson: "Taha Saadat",
  phoneDisplay: "0919 783 9834",
  phoneE164: "+989197839834",
  email: "ziraxa.ai@gmail.com",
  handle: "@ziraxa.ai",

  // Optional. If you have a website, set it here:
  websiteUrl: "", // e.g. "https://ziraxa.ai"
};

const CONTENT = {
  fa: {
    tagline: "راهکارهای هوشمند برای رشد",
    toggleLang: "EN",
    toggleView: "حالت مطالعه",
    downloadPdf: "خروجی PDF",
    hintClick: "برای باز شدن جزئیات، روی هر پنل کلیک کنید.",
    coverLead: "برند شما، با ظاهری لوکس و اجرای دقیق",
    chip1: "کیفیت ممتاز",
    chip2: "راهکارهای سفارشی",
    chip3: "پشتیبانی قابل اتکا",
    aboutEyebrow: "درباره Ziraxa",
    aboutTitle: "ترکیب زیبایی، نظم، و فناوری",
    aboutBody:
      "زیرکسا بر ارائه‌ی راهکارهای دیجیتال دقیق، قابل‌اعتماد و متفاوت تمرکز دارد؛ از طراحی تجربه تا اجرای فنی. هدف ما ایجاد حضوری ماندگار برای برند شماست.",
    aboutBullet1: "هویت بصری ممتاز و یکپارچه",
    aboutBullet2: "تحویل سریع با استانداردهای صنعتی",
    aboutBullet3: "همراهی و پشتیبانی پس از تحویل",
    servicesEyebrow: "خدمات",
    servicesTitle: "آنچه ارائه می‌دهیم",
    svc1t: "طراحی هویت و برند",
    svc2t: "وب‌سایت و لندینگ",
    svc3t: "اتوماسیون و AI",
    svc4t: "مشاوره و اجرا",
    proofEyebrow: "تمایز",
    proofTitle: "چرا Ziraxa؟",
    proof1k: "استاندارد",
    proof1v: "دقت در جزئیات و کنترل کیفیت",
    proof2k: "سفارشی‌سازی",
    proof2v: "راهکارها بر اساس هدف کسب‌وکار شما",
    proof3k: "تحویل",
    proof3v: "تایم‌لاین شفاف و تحویل قابل پیش‌بینی",
    contactEyebrow: "ارتباط",
    contactTitle: "آماده‌ی شروع هستید؟",
    contactPerson: "مسئول ارتباط",
    contactPhone: "تلفن",
    contactEmail: "ایمیل",
    contactHandle: "شناسه",
    qrTitle: "QR برای ذخیره‌ی مخاطب",
    qrBody: "دوربین را روی کد بگیرید تا کارت ویزیت دیجیتال باز شود.",
    backEyebrow: "نمایش حرفه‌ای",
    backTitle: "لوکس، مینیمال، ماندگار",
    backBody:
      "این نسخه‌ی دیجیتال با هدف ارائه‌ی یک تجربه‌ی تعاملی طراحی شده است: سریع، شفاف و قابل اشتراک‌گذاری.",
    badge1: "بهینه برای موبایل",
    badge2: "قابل چاپ",
    badge3: "قابل میزبانی در GitHub Pages",
    footnote:
      "برای استفاده‌ی چاپی، روی «خروجی PDF» کلیک کنید. برای تغییر متن‌ها، فایل script.js را ویرایش کنید.",
    readerTitle: "بروشور دیجیتال Ziraxa",
    readerSubtitle: "هر بخش را باز کنید و جزئیات را ببینید.",
    callNow: "تماس",
    emailNow: "ایمیل",
    readerFooterNote: "ZIRAXA · Contact: Taha Saadat · @ziraxa.ai",
    ctaOpen: "برای مشاهده جزئیات کلیک کنید",
  },
  en: {
    tagline: "Intelligent solutions for growth",
    toggleLang: "FA",
    toggleView: "Reading mode",
    downloadPdf: "Export PDF",
    hintClick: "Click any panel to open details.",
    coverLead: "Luxury presence, engineered with precision",
    chip1: "Premium quality",
    chip2: "Tailored solutions",
    chip3: "Reliable support",
    aboutEyebrow: "About Ziraxa",
    aboutTitle: "A balance of aesthetics, rigor, and technology",
    aboutBody:
      "Ziraxa focuses on delivering precise, dependable, and distinctive digital solutions—from experience design to technical execution—built to create a lasting brand presence.",
    aboutBullet1: "Cohesive premium visual identity",
    aboutBullet2: "Fast delivery with industry standards",
    aboutBullet3: "Post‑delivery partnership & support",
    servicesEyebrow: "Services",
    servicesTitle: "What we deliver",
    svc1t: "Brand & identity design",
    svc2t: "Websites & landing pages",
    svc3t: "Automation & AI",
    svc4t: "Consulting & delivery",
    proofEyebrow: "Differentiators",
    proofTitle: "Why Ziraxa?",
    proof1k: "Standards",
    proof1v: "Detail‑driven execution and QA",
    proof2k: "Customization",
    proof2v: "Solutions aligned to your business objectives",
    proof3k: "Delivery",
    proof3v: "Transparent timelines and predictable outcomes",
    contactEyebrow: "Contact",
    contactTitle: "Ready to start?",
    contactPerson: "Contact person",
    contactPhone: "Phone",
    contactEmail: "Email",
    contactHandle: "Handle",
    qrTitle: "QR to save contact",
    qrBody: "Scan to open a digital business card.",
    backEyebrow: "Professional presence",
    backTitle: "Luxury. Minimal. Memorable.",
    backBody:
      "This digital edition is designed for an interactive experience: fast, clear, and shareable.",
    badge1: "Mobile optimized",
    badge2: "Print friendly",
    badge3: "GitHub Pages ready",
    footnote:
      "For a printable version, click “Export PDF”. To change content, edit script.js.",
    readerTitle: "Ziraxa Digital Brochure",
    readerSubtitle: "Open each section to view details.",
    callNow: "Call",
    emailNow: "Email",
    readerFooterNote: "ZIRAXA · Contact: Taha Saadat · @ziraxa.ai",
    ctaOpen: "Click to view details",
  }
};

const PANELS = ["cover","about","services","proof","contact","back"];

function $(sel, root=document){ return root.querySelector(sel); }
function $all(sel, root=document){ return [...root.querySelectorAll(sel)]; }

let lang = "fa";
let view = "preview";
let activePanel = "cover";
let lastFocused = null;

function applyProfile(){
  // Cover + back panel footer values are hardcoded in HTML for print accuracy;
  // Here we update anchors and reader footer (and you can extend it as needed).
  const tel = `tel:${PROFILE.phoneE164}`;
  const mail = `mailto:${PROFILE.email}`;

  // Update tel/mail links
  $all('a[href^="tel:"]').forEach(a => a.setAttribute("href", tel));
  $all('a[href^="mailto:"]').forEach(a => a.setAttribute("href", mail));

  // Update copy buttons
  $all('[data-copy]').forEach(btn=>{
    const v = btn.getAttribute('data-copy');
    if(v === '+989197839834') btn.setAttribute('data-copy', PROFILE.phoneE164);
    if(v === 'ziraxa.ai@gmail.com') btn.setAttribute('data-copy', PROFILE.email);
  });
}

function applyI18n(){
  document.documentElement.lang = lang;
  document.documentElement.dir = (lang === "fa" ? "rtl" : "ltr");

  $all("[data-i18n]").forEach(el=>{
    const key = el.getAttribute("data-i18n");
    const v = CONTENT[lang][key];
    if(typeof v === "string") el.textContent = v;
  });

  // Button labels already handled; update aria labels direction for modal nav
  $("#langToggle").setAttribute("aria-pressed", lang === "en" ? "true" : "false");
}

function buildAccordion(){
  const acc = $("#accordion");
  acc.innerHTML = "";
  const sections = [
    {
      id:"about",
      title: lang === "fa" ? "درباره Ziraxa" : "About Ziraxa",
      body: () => `
        <p>${CONTENT[lang].aboutBody}</p>
        <ul>
          <li>${CONTENT[lang].aboutBullet1}</li>
          <li>${CONTENT[lang].aboutBullet2}</li>
          <li>${CONTENT[lang].aboutBullet3}</li>
        </ul>
      `
    },
    {
      id:"services",
      title: lang === "fa" ? "خدمات" : "Services",
      body: () => `
        <p>${lang === "fa"
          ? "خدمات زیرکسا به‌صورت ماژولار ارائه می‌شود تا با بودجه و اولویت‌های شما هم‌خوان باشد."
          : "Ziraxa services are modular—aligned with your priorities and budget."}</p>
        <ul>
          <li>${CONTENT[lang].svc1t}</li>
          <li>${CONTENT[lang].svc2t}</li>
          <li>${CONTENT[lang].svc3t}</li>
          <li>${CONTENT[lang].svc4t}</li>
        </ul>
      `
    },
    {
      id:"proof",
      title: lang === "fa" ? "تمایز" : "Differentiators",
      body: () => `
        <div class="grid">
          <div class="card"><strong>${CONTENT[lang].proof1k}:</strong> ${CONTENT[lang].proof1v}</div>
          <div class="card"><strong>${CONTENT[lang].proof2k}:</strong> ${CONTENT[lang].proof2v}</div>
          <div class="card"><strong>${CONTENT[lang].proof3k}:</strong> ${CONTENT[lang].proof3v}</div>
          <div class="card"><strong>${lang==="fa"?"ارتباط":"Communication"}:</strong> ${lang==="fa"
            ? "شفافیت در گزارش‌گیری و ارائه‌ی خروجی قابل اندازه‌گیری."
            : "Clear reporting with measurable deliverables."}</div>
        </div>
      `
    },
    {
      id:"contact",
      title: lang === "fa" ? "ارتباط" : "Contact",
      body: () => `
        <p>${lang==="fa"
          ? "برای شروع همکاری یا دریافت مشاوره، از مسیرهای زیر اقدام کنید."
          : "For collaboration or consultation, reach out via:"}</p>
        <ul>
          <li><strong>${CONTENT[lang].contactPerson}:</strong> ${PROFILE.contactPerson}</li>
          <li><strong>${CONTENT[lang].contactPhone}:</strong> <a class="link" href="tel:${PROFILE.phoneE164}">${PROFILE.phoneDisplay}</a></li>
          <li><strong>${CONTENT[lang].contactEmail}:</strong> <a class="link" href="mailto:${PROFILE.email}">${PROFILE.email}</a></li>
          <li><strong>${CONTENT[lang].contactHandle}:</strong> ${PROFILE.handle}</li>
        </ul>
      `
    }
  ];

  for(const s of sections){
    const item = document.createElement("div");
    item.className = "accItem";
    item.innerHTML = `
      <button class="accBtn" type="button" aria-expanded="false">
        <div class="accTitle">${s.title}</div>
        <div class="accChevron" aria-hidden="true">⌄</div>
      </button>
      <div class="accBody" hidden>${s.body()}</div>
    `;
    const btn = item.querySelector(".accBtn");
    const body = item.querySelector(".accBody");
    btn.addEventListener("click", ()=>{
      const open = btn.getAttribute("aria-expanded") === "true";
      btn.setAttribute("aria-expanded", String(!open));
      body.hidden = open;
      item.querySelector(".accChevron").textContent = open ? "⌄" : "⌃";
    });
    acc.appendChild(item);
  }

  // Update reader footer note
  const note = CONTENT[lang].readerFooterNote
    .replace("Taha Saadat", PROFILE.contactPerson)
    .replace("@ziraxa.ai", PROFILE.handle);
  const el = document.querySelector(".readerFooter__small");
  if(el) el.textContent = note;
}

function openModal(panelId){
  activePanel = panelId;
  lastFocused = document.activeElement;

  const modal = $("#modal");
  const title = $("#modalTitle");
  const body = $("#modalBody");

  const heading = {
    cover: lang==="fa" ? "ZIRAXA | معرفی" : "ZIRAXA | Overview",
    about: lang==="fa" ? "درباره Ziraxa" : "About Ziraxa",
    services: lang==="fa" ? "خدمات" : "Services",
    proof: lang==="fa" ? "چرا Ziraxa؟" : "Why Ziraxa",
    contact: lang==="fa" ? "ارتباط" : "Contact",
    back: lang==="fa" ? "نسخه دیجیتال" : "Digital edition",
  }[panelId] || "ZIRAXA";

  title.textContent = heading;

  const html = {
    cover: `
      <h2>${PROFILE.companyLatin}</h2>
      <p>${lang==="fa"
        ? "بروشور دیجیتال با طراحی لوکس و مینیمال؛ مناسب ارسال در پیام‌رسان‌ها و شبکه‌های اجتماعی."
        : "A luxury‑minimal digital brochure—perfect for sharing across social channels and messaging."}</p>
      <div class="grid">
        <div class="card"><strong>${lang==="fa"?"نام برند":"Brand"}:</strong> ${PROFILE.companyLatin} (${PROFILE.companyFa})</div>
        <div class="card"><strong>${CONTENT[lang].contactPerson}:</strong> ${PROFILE.contactPerson}</div>
        <div class="card"><strong>${CONTENT[lang].contactPhone}:</strong> <a class="link" href="tel:${PROFILE.phoneE164}">${PROFILE.phoneDisplay}</a></div>
        <div class="card"><strong>${CONTENT[lang].contactEmail}:</strong> <a class="link" href="mailto:${PROFILE.email}">${PROFILE.email}</a></div>
      </div>
    `,
    about: `
      <h2>${CONTENT[lang].aboutTitle}</h2>
      <p>${CONTENT[lang].aboutBody}</p>
      <ul>
        <li>${CONTENT[lang].aboutBullet1}</li>
        <li>${CONTENT[lang].aboutBullet2}</li>
        <li>${CONTENT[lang].aboutBullet3}</li>
      </ul>
      <p>${lang==="fa"
        ? "این متن‌ها را می‌توانید به راحتی در فایل script.js تغییر دهید تا کاملاً مطابق حوزه فعالیت شما باشد."
        : "You can easily customize these texts in script.js to match your exact domain and offerings."}</p>
    `,
    services: `
      <h2>${CONTENT[lang].servicesTitle}</h2>
      <p>${lang==="fa"
        ? "ساختار خدمات پیشنهادی زیر عمومی است. در صورت نیاز، نام خدمات و توضیحات را با حوزه کاری واقعی شما جایگزین کنید."
        : "The service structure below is generic. Replace service names/descriptions with your exact offering as needed."}</p>
      <div class="grid">
        <div class="card"><strong>${CONTENT[lang].svc1t}</strong><br/>${lang==="fa"
          ? "تدوین هویت بصری و زبان برند برای ارائه‌ای یکپارچه."
          : "Visual identity and brand language for cohesive presence."}</div>
        <div class="card"><strong>${CONTENT[lang].svc2t}</strong><br/>${lang==="fa"
          ? "سایت‌های سریع، امن و بهینه برای تبدیل."
          : "Fast, secure, conversion‑oriented web experiences."}</div>
        <div class="card"><strong>${CONTENT[lang].svc3t}</strong><br/>${lang==="fa"
          ? "اتصال ابزارها، اتوماسیون فرآیندها و راهکارهای AI."
          : "Tooling integration, workflow automation, and AI solutions."}</div>
        <div class="card"><strong>${CONTENT[lang].svc4t}</strong><br/>${lang==="fa"
          ? "مشاوره، برنامه‌ریزی، اجرا و تحویل قابل اندازه‌گیری."
          : "Consulting, planning, delivery, and measurable outcomes."}</div>
      </div>
    `,
    proof: `
      <h2>${CONTENT[lang].proofTitle}</h2>
      <p>${lang==="fa"
        ? "برای ایجاد اعتماد، مهم‌ترین معیارها را به صورت شفاف نمایش می‌دهیم."
        : "We emphasize clarity on the signals that build trust."}</p>
      <div class="grid">
        <div class="card"><strong>${CONTENT[lang].proof1k}:</strong> ${CONTENT[lang].proof1v}</div>
        <div class="card"><strong>${CONTENT[lang].proof2k}:</strong> ${CONTENT[lang].proof2v}</div>
        <div class="card"><strong>${CONTENT[lang].proof3k}:</strong> ${CONTENT[lang].proof3v}</div>
        <div class="card"><strong>${lang==="fa"?"امنیت":"Security"}:</strong> ${lang==="fa"
          ? "الگوهای استاندارد، محدودسازی دسترسی، و اصول امنیتی در توسعه."
          : "Standard patterns, access controls, and secure delivery practices."}</div>
      </div>
    `,
    contact: `
      <h2>${CONTENT[lang].contactTitle}</h2>
      <p>${lang==="fa"
        ? "این صفحه با یک QR (کارت ویزیت) همراه است تا ذخیره مخاطب سریع انجام شود."
        : "This page includes a QR (digital business card) for quick contact save."}</p>
      <div class="grid">
        <div class="card"><strong>${CONTENT[lang].contactPerson}:</strong> ${PROFILE.contactPerson}</div>
        <div class="card"><strong>${CONTENT[lang].contactPhone}:</strong> <a class="link" href="tel:${PROFILE.phoneE164}">${PROFILE.phoneDisplay}</a></div>
        <div class="card"><strong>${CONTENT[lang].contactEmail}:</strong> <a class="link" href="mailto:${PROFILE.email}">${PROFILE.email}</a></div>
        <div class="card"><strong>${CONTENT[lang].contactHandle}:</strong> ${PROFILE.handle}</div>
      </div>
      ${PROFILE.websiteUrl ? `<p><strong>Website:</strong> <a class="link" href="${PROFILE.websiteUrl}" target="_blank" rel="noreferrer">${PROFILE.websiteUrl}</a></p>` : ""}
    `,
    back: `
      <h2>${lang==="fa" ? "راهنمای استفاده" : "Usage notes"}</h2>
      <ul>
        <li>${lang==="fa" ? "حالت «پیش‌نمایش» برای نمایش سه‌تایی پنل‌هاست." : "Preview shows the tri‑fold panels."}</li>
        <li>${lang==="fa" ? "حالت «مطالعه» برای خواندن سریع و باز/بسته کردن بخش‌هاست." : "Reading mode uses an accordion for fast navigation."}</li>
        <li>${lang==="fa" ? "دکمه «خروجی PDF» برای چاپ و ذخیره PDF است." : "Export PDF triggers print/save as PDF."}</li>
      </ul>
      <p>${lang==="fa"
        ? "برای انتشار در GitHub Pages، پوشه را در یک ریپو قرار دهید و Pages را فعال کنید (راهنما در README موجود است)."
        : "To publish on GitHub Pages, put these files in a repo and enable Pages (see README)."}
      </p>
    `
  }[panelId];

  body.innerHTML = html;

  modal.classList.add("isOpen");
  modal.setAttribute("aria-hidden","false");

  // Focus close button
  $("#modalClose").focus();
}

function closeModal(){
  const modal = $("#modal");
  modal.classList.remove("isOpen");
  modal.setAttribute("aria-hidden","true");
  $("#modalBody").innerHTML = "";
  if(lastFocused && typeof lastFocused.focus === "function") lastFocused.focus();
}

function nextPanel(dir){
  const idx = PANELS.indexOf(activePanel);
  const next = (idx + dir + PANELS.length) % PANELS.length;
  openModal(PANELS[next]);
}

function wireInteractions(){
  // Panel clicks
  $all(".panel").forEach(p=>{
    p.addEventListener("click", ()=> openModal(p.getAttribute("data-panel")));
  });

  // Modal close
  $("#modalClose").addEventListener("click", closeModal);
  $("#modal").addEventListener("click", (e)=>{
    const target = e.target;
    if(target && target.getAttribute && target.getAttribute("data-close") === "true") closeModal();
  });
  document.addEventListener("keydown", (e)=>{
    const modalOpen = $("#modal").classList.contains("isOpen");
    if(!modalOpen) return;
    if(e.key === "Escape") closeModal();
    if(e.key === "ArrowRight") nextPanel(lang==="fa" ? -1 : 1);
    if(e.key === "ArrowLeft") nextPanel(lang==="fa" ? 1 : -1);
  });

  $("#modalPrev").addEventListener("click", ()=> nextPanel(-1));
  $("#modalNext").addEventListener("click", ()=> nextPanel(1));

  // Copy buttons
  $all(".copy").forEach(btn=>{
    btn.addEventListener("click", async ()=>{
      const v = btn.getAttribute("data-copy");
      try{
        await navigator.clipboard.writeText(v);
        btn.textContent = "✓";
        setTimeout(()=> btn.textContent = "⧉", 900);
      }catch{
        // Fallback for restricted contexts
        const ta = document.createElement("textarea");
        ta.value = v;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        btn.textContent = "✓";
        setTimeout(()=> btn.textContent = "⧉", 900);
      }
    });
  });

  // Language toggle
  $("#langToggle").addEventListener("click", ()=>{
    lang = (lang === "fa" ? "en" : "fa");
    applyI18n();
    buildAccordion();
    // Refresh modal if open
    if($("#modal").classList.contains("isOpen")) openModal(activePanel);
  });

  // View toggle
  $("#viewToggle").addEventListener("click", ()=>{
    view = (view === "preview" ? "reader" : "preview");
    $("#preview").classList.toggle("hidden", view !== "preview");
    $("#reader").classList.toggle("hidden", view !== "reader");
    $("#viewToggle").setAttribute("aria-pressed", view === "reader" ? "true" : "false");
  });

  // Print
  $("#printBtn").addEventListener("click", ()=> window.print());
}

function makeVCard(){
  // vCard 3.0 for QR
  // Note: Keep lines with \n and end with \n per vCard typical implementations.
  const lines = [
    "BEGIN:VCARD",
    "VERSION:3.0",
    `FN:${PROFILE.contactPerson}`,
    `ORG:${PROFILE.companyLatin}`,
    `TEL;TYPE=CELL:${PROFILE.phoneE164}`,
    `EMAIL:${PROFILE.email}`,
    PROFILE.websiteUrl ? `URL:${PROFILE.websiteUrl}` : null,
    "END:VCARD"
  ].filter(Boolean);
  return lines.join("\n");
}

function renderQR(){
  const el = document.getElementById("qrcode");
  if(!el) return;

  // If CDN failed, show fallback
  if(typeof window.QRCode === "undefined"){
    el.textContent = "QR";
    return;
  }

  el.innerHTML = "";
  const payload = makeVCard();
  // eslint-disable-next-line no-new
  new QRCode(el, {
    text: payload,
    width: 92,
    height: 92,
    correctLevel: QRCode.CorrectLevel.M
  });
}

function init(){
  applyProfile();
  applyI18n();
  buildAccordion();
  wireInteractions();
  renderQR();
}

document.addEventListener("DOMContentLoaded", init);
